sourceSets {
    deployment {
        java {
            srcDir 'src/deployment/java'
        }
        compileClasspath += configurations.compile
        runtimeClasspath += configurations.compile
    }
}

ext {
    tomcatAppName = 'techops'  //在Tomcat访问的application名字，配置在Tomcat的根目录
    tomcatUsername = 'admin'        //Tomcat用户
    tomcatPassword = 'admin'        //Tomcat密码
    tomcatHost = '192.168.56.101:8080'        //
    tomcatWarFile = 'build/' + tomcatAppName + '.war'
}

war {
    baseName = tomcatAppName
    archiveName = tomcatAppName + '.war'
    destinationDir = file('build')
}

task warTechopsServer(dependsOn: war) {
    // replace the placeholder of the techops end point in static resource files.
}

task tomcatUndeploy(type: JavaExec) {
    main = 'gradle.TomcatDeploy'
    args = ['undeploy',
            tomcatAppName,
            tomcatUsername,
            tomcatPassword,
            tomcatHost]
    classpath = sourceSets.deployment.runtimeClasspath
    doFirst {
        println "removing war file from Tomcat."
    }
}

task tomcatDeploy(type: JavaExec, dependsOn: warTechopsServer) {
    doFirst {
        println "deploying war file " + tomcatWarFile + " to Tomcat."
    }
    main = 'gradle.TomcatDeploy'
    args = ['deploy',
            tomcatAppName,
            tomcatWarFile,
            tomcatUsername,
            tomcatPassword,
            tomcatHost]
    classpath = sourceSets.deployment.runtimeClasspath
}

task tomcatRedeploy(type: JavaExec, dependsOn: warTechopsServer) {
    doFirst {
        println "redeploying war file " + tomcatWarFile + " to Tomcat."
    }
    main = 'gradle.TomcatDeploy'
    args = ['redeploy',
            tomcatAppName,
            tomcatWarFile,
            tomcatUsername,
            tomcatPassword,
            tomcatHost]
    classpath = sourceSets.deployment.runtimeClasspath
}
